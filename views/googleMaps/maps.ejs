
<% if (!title) { %>
  <script>window.location.href = '/'</script>
<% } %>

<div class="container mt-4">
  <h1 class="text-center"><%= title %></h1>
  
  <div class="text-center mb-4">
    <p class="lead">Need a little help knowing where to go? Start here! You have the whole world at your fingertips.</p>
  </div>
  
  <!-- üî• SOLO UN div#map -->
  <div id="map" 
       style="height: 500px; width: 100%; 
              border: 2px solid #4a90e2; 
              border-radius: 10px; 
              margin: 20px 0;">
  </div>
  
  <div class="alert alert-info mt-3" role="alert">
    <small>üìç Showing BYU-Idaho Campus as example location</small>
  </div>
</div>

<script>
  // Solo una funci√≥n gm_authFailure - elimina cualquier otra
  window.gm_authFailure = function() {
    console.error('Google Maps authentication failed');
    document.getElementById('map').innerHTML = 
      '<div class="alert alert-danger text-center p-4 m-4">' +
      '<h4>‚ö†Ô∏è Google Maps Error</h4>' +
      '<p>Failed to load Google Maps. Please check:</p>' +
      '<ul class="text-left">' +
      '<li>API key is valid</li>' +
      '<li>Maps JavaScript API is enabled</li>' +
      '<li>Billing is set up</li>' +
      '<li>Domain restrictions allow this site</li>' +
      '</ul>' +
      '</div>';
  };
  
  function initMap() {
    console.log('initMap called - Google Maps loaded successfully');
    
    // Verificar si el elemento #map existe
    const mapElement = document.getElementById('map');
    if (!mapElement) {
      console.error('Map element not found');
      return;
    }
    
    // Coordenadas de BYU-Idaho
    const byui = { lat: 43.817, lng: -111.783 };
    
    try {
      const map = new google.maps.Map(mapElement, {
        zoom: 15,
        center: byui,
        mapTypeId: 'roadmap',
        mapTypeControl: true,
        streetViewControl: true,
        fullscreenControl: true
      });
      
      new google.maps.Marker({
        position: byui,
        map: map,
        title: "BYU-Idaho Campus",
        animation: google.maps.Animation.DROP
      });
      
      console.log('Map created successfully');
    } catch (error) {
      console.error('Error creating map:', error);
      gm_authFailure();
    }
  }
  
  // Fallback si Google Maps no carga en 5 segundos
  setTimeout(function() {
    if (!window.google || !window.google.maps) {
      console.warn('Google Maps not loaded after 5 seconds');
      if (typeof gm_authFailure === 'function') {
        gm_authFailure();
      }
    }
  }, 5000);
</script>

<!-- A√ëADE "&v=weekly" para forzar versi√≥n estable -->
<script 
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD408Yl6SynvhY_0RF5dBVBHJ-jWloKezI&callback=initMap&v=weekly"
  async
  defer>
</script>